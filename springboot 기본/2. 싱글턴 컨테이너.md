# 2. 싱글톤 컨테이너

- 스프링 컨테이너는 싱글턴 패턴의 문제점을 해결하면서, 객체 인스턴스를 싱글턴으로 관리 <- 싱글턴 컨테이너의 역할

- 즉, 빈이 싱글턴으로 관리된다.

  > 싱글턴 패턴의 문제점
  >
  > - 의존관계가 구체 클래스에 의존한다. <- dip위반
  > - 테스트하기 어렵다
  > - 내부 속성을 변경하거나 초기화하기 어렵다
  > - private 생성자 사용으로 자식 클래스를 만들기 어렵다.
  > - 유연성이 떨어진다.

### 장점

-  싱글턴 패턴을 위한 지저분한 코드가 없어도 된다.
-  DIP, OCP, 테스트, private 생성자로 부터 자유롭게 싱글턴을 사용할 수 있다.

---

## 1. 싱글턴 방식의 주의점

- statuful하게 설계하면 안된다. <- <u>필드가 공유된다.</u>
- 무상태로(stateless)로 설계해야 한다.
    - 특정 클라이언트에 의존적인 필드가 있으면 안된다.
    - 특정 클라이언트가 값을 변경할 수 있게 하면 안된다.

- 필드 대신, `지역변수, 파라미터, ThreadLocal`을 사용해야한다.

---

## 2. @Configuration과 싱글턴

- 스프링 컨테이너는 싱글턴을 유지하기 위해 클래스의 바이트코드를 조작하는 라이브러리를 사용한다.
    - GCLIB
    - **대상 클래스를 상속받은 프록시 객체를 만들고 그 클래스를 빈으로 등록한다.**
- `@Configuration(proxyBeanMethods = false)`를 통해 프록시를 생성하지 않을 수도 있다.
    - 만약 빈으로 등록하려는 메서드가 다른 빈을 의존하지 않는다면 굳이 프록시 객체를 만들 필요없다.

### @Configuration을 사용하지 않고 @Bean만 적용하면 어떻게 될까?

- 싱글턴을 보장하지 않는다.

  

  

